<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Twitch.js documentation</title>
    <link rel="stylesheet" href="/twitch-chat-client@next/static/css/style.css" />
    <style id="server-side-styles">.c0110 {
  color: #b9b9b9;
  padding: 1em;
  position: relative;
  border-bottom: 1px solid #444;
  background-color: #242424;
}
.c0110 h1 {
  margin: 0;
  display: inline;
  font-size: 1.5em;
  font-weight: normal;
}
.c0110 p {
  margin: 0;
}
.c0111 {
  padding: 1em;
}
.c0111 h2 {
  margin: 0;
}
.c014 {
  min-height: 100%;
  border-right: 1px solid #444;
}
.c017 {
  color: #b9b9b9;
  display: block;
}
.c017:not(:first-child) {
  margin-top: 1em;
}
.c018 {
  margin: 0;
  height: 1em;
  padding: .25em .5em .25em .75em;
  font-size: 1.1em;
  line-height: 1em;
  font-weight: bold;
  text-transform: uppercase;
}
.c019 > a {
  padding-left: 1.25em;
}
.c015 {
  color: #b9b9b9;
  height: 1em;
  padding: .5em;
  display: block;
  overflow: hidden;
  transition: .3s background-color ease-in-out, .3s border-left-color ease-in-out;
  line-height: 1em;
  border-left: .25em solid transparent;
  text-overflow: ellipsis;
  text-decoration: none;
}
.c015:hover {
  background-color: #333333;
}
.c016 {
  border-color: #647d0f;
  background-color: #242424;
}
.c016:hover {
  border-left-color: #88ab14;
}
.c011 {
  width: 100%;
  display: flex;
  min-height: 100%;
  flex-direction: row;
}
.c012 {
  width: 250px;
}
.c013 {
  flex: 1;
}
.c013 a {
  color: rgb(148, 148, 148);
  font-weight: bold;
  text-decoration: none;
}</style>
</head>
<body>
<div id="root"><div class="c011"><div class="c014 c012"><a class="c015" href="/twitch-chat-client@next/">Welcome</a><div class="c017"><h2 class="c018">Basic usage</h2><div class="c019"><a class="c015" title="Getting started" href="/twitch-chat-client@next/docs/basic-usage/getting-started.html">Getting started</a><a class="c015" title="Connecting to Chat" href="/twitch-chat-client@next/docs/basic-usage/connecting-to-chat.html">Connecting to Chat</a><a class="c015" title="Listening to events" href="/twitch-chat-client@next/docs/basic-usage/listening-to-events.html">Listening to events</a></div></div><div class="c017"><h2 class="c018">Upgrading</h2><div class="c019"><a class="c015" title="Upgrading from 1.x to 2.x" href="/twitch-chat-client@next/docs/upgrading/v1-to-v2.html">Upgrading from 1.x to 2.x</a></div></div><div class="c017"><h2 class="c018">Examples</h2><div class="c019"><a class="c015 c016" aria-current="page" title="Basic bot" href="/twitch-chat-client@next/docs/examples/basic-bot.html">Basic bot</a></div></div><div class="c017"><h2 class="c018">Classes</h2><div class="c019"><a class="c015" title="ChatClient" href="/twitch-chat-client@next/reference/classes/ChatClient.html">ChatClient</a><a class="c015" title="ChatUser" href="/twitch-chat-client@next/reference/classes/ChatUser.html">ChatUser</a><a class="c015" title="TwitchPrivateMessage" href="/twitch-chat-client@next/reference/classes/TwitchPrivateMessage.html">TwitchPrivateMessage</a></div></div><div class="c017"><h2 class="c018">Interfaces</h2><div class="c019"><a class="c015" title="ChatBitsBadgeUpgradeInfo" href="/twitch-chat-client@next/reference/interfaces/ChatBitsBadgeUpgradeInfo.html">ChatBitsBadgeUpgradeInfo</a><a class="c015" title="ChatClientOptions" href="/twitch-chat-client@next/reference/interfaces/ChatClientOptions.html">ChatClientOptions</a><a class="c015" title="ChatClientOptionsWithAuth" href="/twitch-chat-client@next/reference/interfaces/ChatClientOptionsWithAuth.html">ChatClientOptionsWithAuth</a><a class="c015" title="ChatCommunitySubInfo" href="/twitch-chat-client@next/reference/interfaces/ChatCommunitySubInfo.html">ChatCommunitySubInfo</a><a class="c015" title="ChatRaidInfo" href="/twitch-chat-client@next/reference/interfaces/ChatRaidInfo.html">ChatRaidInfo</a><a class="c015" title="ChatRitualInfo" href="/twitch-chat-client@next/reference/interfaces/ChatRitualInfo.html">ChatRitualInfo</a><a class="c015" title="ChatSubGiftInfo" href="/twitch-chat-client@next/reference/interfaces/ChatSubGiftInfo.html">ChatSubGiftInfo</a><a class="c015" title="ChatSubInfo" href="/twitch-chat-client@next/reference/interfaces/ChatSubInfo.html">ChatSubInfo</a></div></div></div><div class="c013"><main><div class="c0110"><h1>Basic bot</h1></div><div class="c0111"><p>In this example, you learn how to set up a basic bot that reacts to a few commands, and also automatically thanks everyone that subscribes, resubscribes or gifts a subscription.</p><p>We will achieve authorization by fetching an initial access token from Twitch and then refreshing that token using the refreh token provided by the same request.</p><p>If you already have an authentication flow up and running with a <code>TwitchClient</code> instance, you find all you need in step 4 and 5.</p><h2>1. Create a Twitch application</h2><p>Go to your <a href="https://dev.twitch.tv/console/apps">Twitch developer console</a> and create a new application. If you don&#x27;t know what a Redirect URI is, use <code>http://localhost</code>. Write down Client ID and Client Secret somewhere - you&#x27;re gonna need them!</p><h2>2. Obtain an access token from Twitch</h2><p>Visit this site, with the CLIENT_ID and REDIRECT_URI placeholders replaced with your client ID and redirect URI, respectively:</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code>https:<span style="color:#7f7f7f">//id.twitch.tv/oauth2/authorize?client_id=CLIENT_ID</span>
	&amp;redirect_uri=REDIRECT_URI
	&amp;response_type=code
	&amp;scope=chat:read+chat:edit
</code></pre><p>Log in with the account you want to use for your bot and confirm the access to Twitch. You should get redirected to your redirect URI with a query parameter named <code>code</code>.</p><p>Using a tool like <a href="https://insomnia.rest/">Insomnia</a> or <a href="https://www.getpostman.com/">Postman</a>, make a <code>POST</code> request to this URL, again, with all placeholders replaced:</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code>https:<span style="color:#7f7f7f">//id.twitch.tv/oauth2/token?client_id=CLIENT_ID</span>
    &amp;client_secret=CLIENT_SECRET
    &amp;code=CODE_FROM_LAST_REQUEST
    &amp;grant_type=authorization_code
    &amp;redirect_uri=REDIRECT_URI
</code></pre><p>The response body should look similar to the following:</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code>{
  <span style="color:#6a8759">&quot;access_token&quot;</span>: <span style="color:#6a8759">&quot;0123456789abcdefghijABCDEFGHIJ&quot;</span>,
  <span style="color:#6a8759">&quot;refresh_token&quot;</span>: <span style="color:#6a8759">&quot;eyJfaWQmNzMtNGCJ9%6VFV5LNrZFUj8oU231/3Aj&quot;</span>,
  <span style="color:#6a8759">&quot;expires_in&quot;</span>: <span style="color:#6896ba">3600</span>,
  <span style="color:#6a8759">&quot;scope&quot;</span>: [<span style="color:#6a8759">&quot;chat:read&quot;</span>, <span style="color:#6a8759">&quot;chat:edit&quot;</span>],
  <span style="color:#6a8759">&quot;token_type&quot;</span>: <span style="color:#6a8759">&quot;bearer&quot;</span>
}
</code></pre><p>Write down the <code>access_token</code> and <code>refresh_token</code> properties of the response body. These are important for all the other requests you&#x27;re sending to Twitch!</p><h2>3. Create a <code>TwitchClient</code> instance</h2><p>Now you can finally start writing code! First, import all the classes you&#x27;re gonna need from <code>twitch</code> and <code>twitch-chat-client</code>.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code><span style="color:#cb7832">import</span> TwitchClient <span style="color:#cb7832">from</span> <span style="color:#6a8759">&#x27;twitch&#x27;</span>;
<span style="color:#cb7832">import</span> ChatClient <span style="color:#cb7832">from</span> <span style="color:#6a8759">&#x27;twitch-chat-client&#x27;</span>;
</code></pre><p>Now, as long as <a href="https://github.com/tc39/proposal-top-level-await">top-level await</a> has not landed in popular runtimes, you need to work around that by placing your main routine inside an immediately executed inline function expression.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code>(<span style="color:#cb7832">async</span> () =&gt; {
	<span style="color:#7f7f7f">// code goes here</span>
})();
</code></pre><p>All the following code needs to be inside this function (or at least called from inside it) so we can use <code>await</code> and still avoid race conditions.</p><p>Now, we can construct a <code>TwitchClient</code> instance:</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code><span style="color:#cb7832">const</span> clientId = <span style="color:#6a8759">&#x27;uo6dggojyb8d6soh92zknwmi5ej1q2&#x27;</span>;
<span style="color:#cb7832">const</span> accessToken = <span style="color:#6a8759">&#x27;0123456789abcdefghijABCDEFGHIJ&#x27;</span>;
<span style="color:#cb7832">const</span> twitchClient = <span style="color:#cb7832">await</span> TwitchClient.withCredentials(clientId, accessToken);
</code></pre><h2>4. Connect to chat</h2><p>Using the <code>TwitchClient</code> instance we just created, we can easily create a <code>ChatClient</code> instance.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code><span style="color:#cb7832">const</span> chatClient = <span style="color:#cb7832">await</span> ChatClient.forTwitchClient(twitchClient);
</code></pre><p>Now, you can connect to your chat.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code><span style="color:#cb7832">await</span> chatClient.connect();
<span style="color:#cb7832">await</span> chatClient.waitForRegistration();
<span style="color:#cb7832">await</span> chatClient.join(<span style="color:#6a8759">&#x27;satisfiedpear&#x27;</span>);
</code></pre><p>You can join multiple channels - all you have to do is repeat that last line with another channel name.</p><p>Now you can run your code and see your bot sitting in your channel. But we want it to do something!</p><h2>5. Listen and react to events</h2><p>Fortunately, reacting to things is easy. To listen to chat messages, just use the <code>onPrivmsg</code> method. As an example, we implement a few basic commands here:</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code>chatClient.onPrivmsg(<span>(<span style="color:#b9b9b9">channel, user, message</span>) =&gt;</span> {
	<span style="color:#cb7832">if</span> (message === <span style="color:#6a8759">&#x27;!ping&#x27;</span>) {
		chatClient.say(channel, <span style="color:#6a8759">&#x27;Pong!&#x27;</span>);
	} <span style="color:#cb7832">else</span> <span style="color:#cb7832">if</span> (message === <span style="color:#6a8759">&#x27;!dice&#x27;</span>) {
		<span style="color:#cb7832">const</span> diceRoll = <span style="color:#e0c46c">Math</span>.floor(<span style="color:#e0c46c">Math</span>.random() * <span style="color:#6896ba">6</span>) + <span style="color:#6896ba">1</span>;
		chatClient.say(channel, <span style="color:#6a8759">`@<span style="color:#e0c46c">${user}</span> rolled a <span style="color:#e0c46c">${diceRoll}</span>`</span>)
	}
});
</code></pre><p>Handling subscriptions is also pretty easy.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code>chatClient.onSub(<span>(<span style="color:#b9b9b9">channel, user</span>) =&gt;</span> {
	chatClient.say(channel, <span style="color:#6a8759">`Thanks to @<span style="color:#e0c46c">${user}</span> for subscribing to the channel!`</span>);
});

chatClient.onResub(<span>(<span style="color:#b9b9b9">channel, user, subInfo</span>) =&gt;</span> {
	chatClient.say(channel, <span style="color:#6a8759">`Thanks to @<span style="color:#e0c46c">${user}</span> for subscribing to the channel for a total of <span style="color:#e0c46c">${subInfo.months}</span> months!`</span>);
});

chatClient.onSubGift(<span>(<span style="color:#b9b9b9">channel, user, subInfo</span>) =&gt;</span> {
	chatClient.say(channel, <span style="color:#6a8759">`Thanks to <span style="color:#e0c46c">${subInfo.gifter}</span> for gifting a subscription to <span style="color:#e0c46c">${user}</span>!`</span>);
});
</code></pre><p>Now you have a working bot! Until you have to restart it a few hours later...</p><h2>6. Setting up automatic token refreshing</h2><p>Fortunately, with the access token in step 2, we also got a refresh token! (You wrote that down, didn&#x27;t you?)</p><p>You can pass that to the <code>TwitchClient</code> factory method to create a client that automatically refreshes the given token.</p><p>Just replace the initialization line with this (but keep the <code>clientId</code> and <code>accessToken</code> constants):</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code><span style="color:#cb7832">const</span> clientSecret = <span style="color:#6a8759">&#x27;nyo51xcdrerl8z9m56w9w6wg&#x27;</span>;
<span style="color:#cb7832">const</span> refreshToken = <span style="color:#6a8759">&#x27;eyJfaWQmNzMtNGCJ9%6VFV5LNrZFUj8oU231/3Aj&#x27;</span>;

<span style="color:#cb7832">const</span> twitchClient = TwitchClient.withCredentials(clientId, accessToken, <span style="color:#6896ba">undefined</span>, {
	clientSecret,
	refreshToken
});
</code></pre><h2>7. Persisting the refreshed token data</h2><p>The last problem we have is restarting the bot. When it crashes for any reason, the refreshed token is gone and the application will try using the old token again, which probably fails.</p><p>The <code>refreshConfig</code> parameter we just added can contain another property named <code>onRefresh</code>. Using this, you can persist tokens as soon as they&#x27;re refreshed.</p><p>To prepare for this, let&#x27;s move the tokens to a JSON file named <code>tokens.json</code>:</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code>{
	<span style="color:#6a8759">&quot;accessToken&quot;</span>: <span style="color:#6a8759">&quot;0123456789abcdefghijABCDEFGHIJ&quot;</span>,
	<span style="color:#6a8759">&quot;refreshToken&quot;</span>: <span style="color:#6a8759">&quot;eyJfaWQmNzMtNGCJ9%6VFV5LNrZFUj8oU231/3Aj&quot;</span>,
	<span style="color:#6a8759">&quot;expiryTimestamp&quot;</span>: <span style="color:#6896ba">0</span>
}
</code></pre><p>I also added a new property called <code>expiryTimestamp</code>. It will save the expiry time of the access token so the client can determine when to refresh the token without making a failing call first. If you didn&#x27;t calculate the expiry timestamp after sending the manual code request (you probably didn&#x27;t - I wouldn&#x27;t either), you can initialize it to zero to always make a refresh call in the beginning.</p><p>Now, we can parse this JSON file on startup, load the tokens from it and when the tokens refresh, save them back into the same file. For the file I/O, I prefer to use the <code>fs-extra</code> package because it provides a promisified interface to the filesystem, unlike the <code>fs</code> package shipped with Node, which still uses callbacks.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code><span style="color:#7f7f7f">// add to import block before async function</span>
<span style="color:#cb7832">import</span> * <span style="color:#cb7832">as</span> fs <span style="color:#cb7832">from</span> <span style="color:#6a8759">&#x27;fs-extra&#x27;</span>;

<span style="color:#7f7f7f">// inside the async function again</span>
<span style="color:#cb7832">const</span> tokenData = <span style="color:#e0c46c">JSON</span>.parse(<span style="color:#cb7832">await</span> fs.readFile(<span style="color:#6a8759">&#x27;./tokens.json&#x27;</span>));
<span style="color:#cb7832">const</span> twitchClient = <span style="color:#cb7832">await</span> TwitchClient.withCredentials(clientId, tokenData.accessToken, <span style="color:#6896ba">undefined</span>, {
        clientSecret,
        refreshToken: tokenData.refreshToken,
        expiry: tokenData.expiryTimestamp === <span style="color:#6896ba">null</span> ? <span style="color:#6896ba">null</span> : <span style="color:#cb7832">new</span> <span style="color:#e0c46c">Date</span>(tokenData.expiryTimestamp),
        onRefresh: <span style="color:#cb7832">async</span> ({ accessToken, refreshToken, expiryDate }) =&gt; {
            <span style="color:#cb7832">const</span> newTokenData = {
                accessToken,
                refreshToken,
                expiryTimestamp: expiryDate === <span style="color:#6896ba">null</span> ? <span style="color:#6896ba">null</span> : expiryDate.getTime()
            };
            <span style="color:#cb7832">await</span> fs.writeFile(<span style="color:#6a8759">&#x27;./tokens.json&#x27;</span>, <span style="color:#e0c46c">JSON</span>.stringify(newTokenData, <span style="color:#6896ba">null</span>, <span style="color:#6896ba">4</span>), <span style="color:#6a8759">&#x27;UTF-8&#x27;</span>)
        }
    });
</code></pre><h2>8. ???</h2><p>We&#x27;re done! Your bot should now connect to chat and react to a few basic commands as well as subs, resubs and gift subs. It is able to recover gracefully when crashing.</p><h2>9. Profit!</h2><p>Now you can implement a more elaborated command system, add more events to react to, and much more! All events are documented in the <a href="/twitch-chat-client@next/reference/classes/ChatClient.html">ChatClient</a> class. And don&#x27;t forget to have fun!</p><p>For reference, here&#x27;s the full code that <em>should</em> be the result of everything we just did:</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code><span style="color:#cb7832">import</span> TwitchClient <span style="color:#cb7832">from</span> <span style="color:#6a8759">&#x27;twitch&#x27;</span>;
<span style="color:#cb7832">import</span> ChatClient <span style="color:#cb7832">from</span> <span style="color:#6a8759">&#x27;twitch-chat-client&#x27;</span>;
<span style="color:#cb7832">import</span> * <span style="color:#cb7832">as</span> fs <span style="color:#cb7832">from</span> <span style="color:#6a8759">&#x27;fs-extra&#x27;</span>;

<span>(<span style="color:#b9b9b9"><span style="color:#cb7832">async</span> (<span style="color:#b9b9b9"></span>) =&gt; {
    <span style="color:#cb7832">const</span> clientId = &#x27;uo6dggojyb8d6soh92zknwmi5ej1q2&#x27;;
    <span style="color:#cb7832">const</span> clientSecret = &#x27;nyo51xcdrerl8z9m56w9w6wg&#x27;;
    <span style="color:#cb7832">const</span> tokenData = <span style="color:#e0c46c">JSON</span>.parse(<span style="color:#b9b9b9"><span style="color:#cb7832">await</span> fs.readFile(<span style="color:#b9b9b9">&#x27;./tokens.json&#x27;, &#x27;UTF-8&#x27;</span>)</span>);
    <span style="color:#cb7832">const</span> twitchClient = <span style="color:#cb7832">await</span> TwitchClient.withCredentials(<span style="color:#b9b9b9">clientId, tokenData.accessToken, <span style="color:#6896ba">undefined</span>, {
        clientSecret,
        refreshToken: tokenData.refreshToken,
        expiry: tokenData.expiryTimestamp === <span style="color:#6896ba">null</span> ? <span style="color:#6896ba">null</span> : <span style="color:#cb7832">new</span> <span style="color:#e0c46c">Date</span>(<span style="color:#b9b9b9">tokenData.expiryTimestamp</span>),
        onRefresh: <span style="color:#cb7832">async</span> (<span style="color:#b9b9b9">{ accessToken, refreshToken, expiryDate }</span>) =&gt; {
            <span style="color:#cb7832">const</span> newTokenData = {
                accessToken,
                refreshToken,
                expiryTimestamp: expiryDate === <span style="color:#6896ba">null</span> ? <span style="color:#6896ba">null</span> : expiryDate.getTime(<span style="color:#b9b9b9"></span>)
            };
            <span style="color:#cb7832">await</span> fs.writeFile(<span style="color:#b9b9b9">&#x27;./tokens.json&#x27;, <span style="color:#e0c46c">JSON</span>.stringify(<span style="color:#b9b9b9">newTokenData, <span style="color:#6896ba">null</span>, 4</span>), &#x27;UTF-8&#x27;</span>)
        }
    }</span>);

    <span style="color:#cb7832">const</span> chatClient = <span style="color:#cb7832">await</span> ChatClient.forTwitchClient(<span style="color:#b9b9b9">twitchClient</span>);

    <span style="color:#cb7832">await</span> chatClient.connect(<span style="color:#b9b9b9"></span>);
    <span style="color:#cb7832">await</span> chatClient.waitForRegistration(<span style="color:#b9b9b9"></span>);
    <span style="color:#cb7832">await</span> chatClient.join(<span style="color:#b9b9b9">&#x27;satisfiedpear&#x27;</span>);

    chatClient.onPrivmsg(<span style="color:#b9b9b9">(<span style="color:#b9b9b9">channel, user, message</span>) =&gt; {
        <span style="color:#cb7832">if</span> (<span style="color:#b9b9b9">message === &#x27;!ping&#x27;</span>) {
            chatClient.say(<span style="color:#b9b9b9">channel, &#x27;Pong!&#x27;</span>);
        } <span style="color:#cb7832">else</span> <span style="color:#cb7832">if</span> (<span style="color:#b9b9b9">message === &#x27;!dice&#x27;</span>) {
            <span style="color:#cb7832">const</span> diceRoll = <span style="color:#e0c46c">Math</span>.floor(<span style="color:#b9b9b9"><span style="color:#e0c46c">Math</span>.random(<span style="color:#b9b9b9"></span>) * 6</span>) + 1;
            chatClient.say(<span style="color:#b9b9b9">channel, `@${user} rolled a ${diceRoll}`</span>)
        }
    }</span>);

    chatClient.onSub(<span style="color:#b9b9b9">(<span style="color:#b9b9b9">channel, user</span>) =&gt; {
        chatClient.say(<span style="color:#b9b9b9">channel, `Thanks to @${user} <span style="color:#cb7832">for</span> subscribing to the channel!`</span>);
    }</span>);
    chatClient.onResub(<span style="color:#b9b9b9">(<span style="color:#b9b9b9">channel, user, subInfo</span>) =&gt; {
        chatClient.say(<span style="color:#b9b9b9">channel, `Thanks to @${user} <span style="color:#cb7832">for</span> subscribing to the channel <span style="color:#cb7832">for</span> a total of ${subInfo.months} months!`</span>);
    }</span>);
    chatClient.onSubGift(<span style="color:#b9b9b9">(<span style="color:#b9b9b9">channel, user, subInfo</span>) =&gt; {
        chatClient.say(<span style="color:#b9b9b9">channel, `Thanks to ${subInfo.gifter} <span style="color:#cb7832">for</span> gifting a subscription to ${user}!`</span>);
    }</span>);
}</span>)<span style="color:#b9b9b9">()</span>;
</span></code></pre></div></main></div></div></div>
</body>
</html>